import{K as O,r as t,j as e,L as R}from"./app-CV7uQCN8.js";import{A as q}from"./app-layout-DW-QwsIP.js";import"./navbar-B6tlJW2d.js";function X(){var k;const{usuario:c,suscripcionActiva:r,compras:g,inscripciones:f}=O().props,[o,F]=t.useState("info"),[_,b]=t.useState(!1),[j,D]=t.useState(c.foto_perfil_url),[E,d]=t.useState(!1),[y,m]=t.useState(null),N=t.useRef(null),[w,v]=t.useState(""),[u,S]=t.useState(""),[C,A]=t.useState(!1),[x,l]=t.useState(null),P=r?Math.max(0,Math.ceil((new Date(r.fecha_fin).getTime()-new Date().getTime())/(1e3*60*60*24))):0,h=(k=document.querySelector('meta[name="csrf-token"]'))==null?void 0:k.getAttribute("content"),L=()=>{var a;(a=N.current)==null||a.click()},T=async a=>{if(!a.target.files||a.target.files.length===0)return;const n=a.target.files[0],i=new FormData;i.append("imagen",n),d(!0),m(null);try{const s=await fetch("/mi-cuenta/actualizar-imagen",{method:"POST",headers:{"X-CSRF-TOKEN":h??""},body:i});if(!s.ok){m("Error al subir la foto"),d(!1);return}const p=await s.json();D(p.foto_perfil_url),d(!1),window.location.reload()}catch{m("Error inesperado al subir la foto"),d(!1)}},z=async()=>{try{(await fetch("/mi-cuenta/cancelar-suscripcion",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":h??""}})).ok?window.location.reload():alert("Error al cancelar suscripción")}catch{alert("Error inesperado al cancelar suscripción")}},M=async a=>{a.preventDefault(),A(!0),l(null);try{const n=await fetch("/mi-cuenta/cambiar-contrasena",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":h??""},credentials:"same-origin",body:JSON.stringify({contrasena_actual:w,nueva_contrasena:u,nueva_contrasena_confirmation:u})});if(n.ok)l("Contraseña actualizada correctamente."),v(""),S("");else if(n.status===422){const i=await n.json(),s=i.errors;s!=null&&s.contrasena_actual?l(s.contrasena_actual.join(" ")):s!=null&&s.nueva_contrasena?l(s.nueva_contrasena.join(" ")):l(i.message||"Error en la validación. La contraseña actual introducida es incorrecta")}}catch{l("Error inesperado al actualizar contraseña.")}finally{A(!1)}};return e.jsxs(q,{children:[e.jsx(R,{title:"Mi cuenta"}),e.jsxs("div",{className:"max-w-5xl mx-auto p-6 text-gray-900",children:[e.jsx("div",{className:"flex justify-center mb-12",children:e.jsxs("div",{className:"relative w-40 h-40 rounded-full overflow-hidden cursor-pointer group ring-4 ring-[#41A510]/30 shadow-lg transition",onClick:L,children:[e.jsx("img",{src:j,alt:j.includes("/images/defaults/avatar.jpg")?"Avatar por defecto":`Foto de perfil de ${c.nombre_completo}`,className:`object-cover w-full h-full ${E?"opacity-60":""} transition duration-300`,draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-30 opacity-0 group-hover:opacity-60 flex items-center justify-center transition duration-300",children:e.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536M9 11l6-6m-1.5 1.5L9 11m0 0v6a1 1 0 001 1h6m-6 0L4 21l-1-1 8-8z"})})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:N,onChange:T})]})}),y&&e.jsx("p",{className:"text-center text-red-600 mb-6 font-semibold",children:y}),e.jsx("nav",{className:"flex justify-center space-x-10 mb-12 border-b border-gray-200",children:["info","suscripcion","contrasena","historial"].map(a=>e.jsx("button",{onClick:()=>F(a),className:`relative pb-3 text-lg font-semibold transition-all duration-300 cursor-pointer ${o===a?"text-[#41A510] after:absolute after:bottom-0 after:left-0 after:w-full after:h-1 after:bg-[#41A510]":"text-gray-500 hover:text-[#41A510]"}`,children:{info:"Información",suscripcion:"Suscripción",contrasena:"Contraseña",historial:"Historial"}[a]},a))}),e.jsxs("div",{children:[o==="info"&&e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 space-y-4 max-w-xl mx-auto border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Nombre:"}),e.jsx("span",{children:c.nombre_completo})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Email:"}),e.jsx("span",{children:c.email})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"DNI:"}),e.jsx("span",{children:c.documentacion})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Domicilio:"}),e.jsx("span",{children:c.domicilio})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"Suscripción activa:"}),e.jsx("span",{className:`font-bold ${r?"text-[#41A510]":"text-gray-400"}`,children:r?"Sí":"Ninguna"})]})]}),o==="suscripcion"&&e.jsx("div",{className:"max-w-xl mx-auto text-gray-800",children:r?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-md p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xl font-semibold text-[#41A510]",children:r.plan.nombre}),e.jsx("span",{className:"text-sm bg-[#41A510]/10 text-[#41A510] px-3 py-1 rounded-full",children:"Activa"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Inicio:"})," ",new Date(r.fecha_inicio).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Finaliza:"})," ",new Date(r.fecha_fin).toLocaleDateString(),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",P," días restantes)"]})]}),e.jsx("button",{onClick:()=>b(!0),className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition cursor-pointer",children:"Cancelar suscripción"})]}):e.jsx("div",{className:"text-center text-gray-500 py-6 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:"No tienes ninguna suscripción activa."})}),o==="contrasena"&&e.jsxs("form",{onSubmit:M,className:"max-w-md mx-auto space-y-4 bg-white p-6 rounded-xl shadow border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1 text-gray-700",children:"Contraseña actual"}),e.jsx("input",{type:"password",value:w,onChange:a=>v(a.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#41A510]/50 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1 text-gray-700",children:"Nueva contraseña"}),e.jsx("input",{type:"password",value:u,onChange:a=>S(a.target.value),required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#41A510]/50 focus:outline-none"})]}),e.jsx("button",{type:"submit",disabled:C,className:"w-full bg-[#41A510] text-white py-2 rounded hover:bg-[#3B940E] transition cursor-pointer",children:C?"Actualizando...":"Actualizar contraseña"}),x&&e.jsx("p",{className:`text-sm mt-2 text-center ${x.includes("correctamente")?"text-green-600":"text-red-600"}`,children:x})]}),o==="historial"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto text-gray-800",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-6 text-[#41A510]",children:"Compras"}),g.length>0?e.jsx("ul",{className:"space-y-6",children:g.map(a=>{var n,i;return e.jsxs("li",{className:"bg-gray-50 border rounded-lg p-4 shadow-sm",children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(a.fecha).toLocaleDateString()]}),e.jsx("ul",{className:"divide-y divide-gray-200",children:a.productos.map((s,p)=>e.jsxs("li",{className:"flex items-center py-2 gap-3",children:[e.jsx("img",{src:s.imagen_url??"/images/productos/producto-generico.png",alt:s.nombre,className:"w-14 h-14 object-cover border rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.precio.toFixed(2)," € x ",s.cantidad]})]})]},p))}),e.jsxs("p",{className:"text-right mt-4 font-semibold text-[#41A510]",children:["Total: ",((i=(n=a.pago)==null?void 0:n.monto)==null?void 0:i.toFixed(2))??"0.00"," €"]})]},a.id)})}):e.jsx("p",{className:"text-gray-600",children:"No hay compras registradas."})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-6 text-[#41A510]",children:"Inscripciones"}),f.length>0?e.jsx("ul",{className:"space-y-6",children:f.map(a=>e.jsxs("li",{className:"bg-gray-50 border rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"font-medium text-lg",children:a.clase.nombre}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Fecha: ",new Date(a.fecha).toLocaleDateString()]})]},a.id))}):e.jsx("p",{className:"text-gray-600",children:"No hay inscripciones registradas."})]})]})]})]}),_&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-lg text-gray-800",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"¿Estás seguro de que quieres dar de baja la suscripción que tienes activa?"}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded cursor-pointer",children:"Cancelar"}),e.jsx("button",{onClick:z,className:"px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded cursor-pointer",children:"Confirmar cancelación"})]})]})})]})}export{X as default};
