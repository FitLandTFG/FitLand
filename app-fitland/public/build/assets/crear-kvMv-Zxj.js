import{m as j,r as m,j as e}from"./app-CV7uQCN8.js";const v=({compras:r,suscripciones:t})=>{const{data:o,setData:d,post:x,processing:u,errors:l}=j({tipo:"compra",compra_id:"",suscripcion_id:"",fecha_pago:"",metodo_pago:"",transaccion_id:"",estado:"pendiente"}),[h,c]=m.useState(0);m.useEffect(()=>{if(o.tipo==="compra"){const a=r.find(s=>s.id===Number(o.compra_id));if(a){const s=a.productos.reduce((i,n)=>{var p;return i+n.precio*(((p=n.pivot)==null?void 0:p.cantidad)??0)},0);c(s)}else c(0)}else{const a=t.find(s=>s.id===Number(o.suscripcion_id));c((a==null?void 0:a.precio)??0)}},[o.tipo,o.compra_id,o.suscripcion_id,r,t]);const b=a=>{a.preventDefault(),x("/admin/pagos")};return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Registrar Pago"}),e.jsxs("form",{onSubmit:b,className:"space-y-4 max-w-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Tipo de Pago"}),e.jsxs("select",{value:o.tipo,onChange:a=>d("tipo",a.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"compra",children:"Compra"}),e.jsx("option",{value:"suscripcion",children:"Suscripción"})]})]}),o.tipo==="compra"?e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Compra"}),e.jsxs("select",{value:o.compra_id,onChange:a=>d("compra_id",a.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Seleccionar compra"}),r.map(a=>{var s;return e.jsxs("option",{value:a.id,children:["#",a.id," - ",a.fecha_compra," - ",(s=a.usuario)==null?void 0:s.nombre_completo]},a.id)})]}),l.compra_id&&e.jsx("p",{className:"text-red-600 text-sm",children:l.compra_id})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Suscripción"}),e.jsxs("select",{value:o.suscripcion_id,onChange:a=>d("suscripcion_id",a.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Seleccionar suscripción"}),t.map(a=>{var s,i;return e.jsxs("option",{value:a.id,children:["#",a.id," - ",(s=a.usuario)==null?void 0:s.nombre_completo," - ",(i=a.plan)==null?void 0:i.nombre]},a.id)})]}),l.suscripcion_id&&e.jsx("p",{className:"text-red-600 text-sm",children:l.suscripcion_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Monto Total (€)"}),e.jsx("input",{type:"number",readOnly:!0,value:h,className:"w-full border rounded px-3 py-2 bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Fecha y hora de Pago"}),e.jsx("input",{type:"datetime-local",value:o.fecha_pago.slice(0,16),onChange:a=>d("fecha_pago",a.target.value),className:"w-full border rounded px-3 py-2"}),l.fecha_pago&&e.jsx("p",{className:"text-red-600 text-sm",children:l.fecha_pago})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Método de Pago"}),e.jsx("input",{type:"text",value:o.metodo_pago,onChange:a=>d("metodo_pago",a.target.value),className:"w-full border rounded px-3 py-2"}),l.metodo_pago&&e.jsx("p",{className:"text-red-600 text-sm",children:l.metodo_pago})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"ID de Transacción (opcional)"}),e.jsx("input",{type:"text",value:o.transaccion_id,onChange:a=>d("transaccion_id",a.target.value),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Estado"}),e.jsxs("select",{value:o.estado,onChange:a=>d("estado",a.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"}),e.jsx("option",{value:"fallido",children:"Fallido"})]}),l.estado&&e.jsx("p",{className:"text-red-600 text-sm",children:l.estado})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"Registrar pago"}),e.jsx("a",{href:"/admin/pagos",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Volver"})]})]})]})};export{v as default};
