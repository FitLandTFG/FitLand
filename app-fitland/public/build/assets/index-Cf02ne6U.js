import{K as j,r as i,j as e,L as f}from"./app-CV7uQCN8.js";import{A as N}from"./app-layout-DW-QwsIP.js";import"./navbar-B6tlJW2d.js";function S(){const{suscripcion:d}=j().props,g=d==="Diamond Mensual"||d==="Diamond Anual",[o,c]=i.useState([]),[n,x]=i.useState(0);i.useEffect(()=>{const r=localStorage.getItem("carrito"),t=r?JSON.parse(r):[];c(t),p(t)},[]);const p=r=>{const t=r.reduce((s,a)=>s+a.precio*a.cantidad,0);x(t)},h=r=>{c(r),localStorage.setItem("carrito",JSON.stringify(r)),p(r)},u=(r,t)=>{const s=o.map(a=>{if(a.id===r){const l=a.cantidad+t;return l<=0?null:a.stock!==void 0&&l>a.stock?a:{...a,cantidad:l}}return a}).filter(a=>a!==null);h(s)},m=()=>{localStorage.removeItem("carrito"),c([]),x(0),window.dispatchEvent(new Event("carritoActualizado"))},b=async()=>{var r;try{const t=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");localStorage.removeItem("plan_id"),localStorage.setItem("carrito",JSON.stringify(o));const a=await(await fetch("/pago/crear-sesion",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t??""},body:JSON.stringify({carrito:o})})).json();a.url?window.location.href=a.url:alert("No se pudo iniciar el pago.")}catch(t){console.error("Error al procesar el pago:",t),alert("Ocurrió un error al procesar el pago.")}};return e.jsxs(N,{children:[e.jsx(f,{title:"Carrito"}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Tu carrito"}),o.length===0?e.jsx("p",{children:"No hay productos en el carrito."}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-4",children:o.map(r=>e.jsx("li",{className:"flex items-center justify-between border-b pb-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:r.imagen,alt:r.nombre,className:"w-20 h-20 object-contain rounded border"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:r.nombre}),e.jsxs("p",{children:["Precio: €",r.precio.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Stock: ",r.stock??"N/D"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>u(r.id,-1),className:"bg-gray-300 px-2 rounded text-black hover:bg-gray-400 cursor-pointer",children:"–"}),e.jsx("span",{children:r.cantidad}),e.jsx("button",{onClick:()=>u(r.id,1),disabled:r.stock!==void 0&&r.cantidad>=r.stock,className:"bg-gray-300 px-2 rounded text-black hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:"+"})]})]})]})},r.id))}),e.jsxs("div",{className:"mt-6 text-right",children:[e.jsxs("div",{className:"text-right mb-4",children:[e.jsxs("p",{className:"text-xl font-semibold",children:["Total: €",n]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-green-700 font-semibold",children:["Descuento (10%): –€",n*.1]}),e.jsxs("p",{className:"text-2xl font-bold mt-1",children:["Total a pagar: €",n*.9]})]})]}),e.jsx("button",{onClick:m,className:"bg-gray-300 hover:bg-gray-400 text-black px-6 py-2 rounded cursor-pointer",children:"Vaciar carrito"}),e.jsx("button",{onClick:b,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded ml-4 cursor-pointer",children:"Pagar"})]})]})]})]})}export{S as default};
